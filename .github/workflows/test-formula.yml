name: Test Formula

on:
  # push:
  #   branches: [ main ]
  # pull_request:
  #   branches: [ main ]
  workflow_dispatch:

jobs:
  test-formula:
    runs-on: macos-14

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Homebrew (minimal)
        run: |
          echo "/opt/homebrew/bin" >> $GITHUB_PATH
          echo "/opt/homebrew/sbin" >> $GITHUB_PATH

      - name: Test formula syntax
        run: |
          cd Formula
          if ruby -c mayaflux-dev.rb; then
            echo "✅ Formula syntax is valid"
          else
            echo "❌ Formula syntax error"
            exit 1
          fi

      - name: Check formula content
        run: |
          echo "=== Formula Content Check ==="
          cd Formula
          grep -E "^(class|desc|homepage|url|sha256|depends_on)" mayaflux-dev.rb
          echo ""
          echo "=== Dependencies ==="
          grep "depends_on" mayaflux-dev.rb | wc -l
          echo "dependencies found"
